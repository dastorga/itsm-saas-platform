<div class="ticket-create-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>
        <i class="icon-ticket"></i>
        Create New Ticket
      </h1>
      <p class="header-subtitle">Report an issue, request a service, or submit a change request</p>
    </div>
  </div>

  <!-- Loading state -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading form data...</p>
  </div>

  <!-- Error message -->
  <div *ngIf="error" class="alert alert-danger">
    <i class="icon-warning"></i>
    {{ error }}
    <button class="btn btn-link" (click)="loadInitialData()">Retry</button>
  </div>

  <!-- Form -->
  <div *ngIf="!isLoading" class="form-container">
    <form [formGroup]="ticketForm" (ngSubmit)="onSubmit()" class="ticket-form">
      
      <!-- Basic Information Section -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="icon-info"></i>
          Basic Information
        </h2>

        <!-- Title -->
        <div class="form-group">
          <label for="title" class="form-label">
            Title <span class="required">*</span>
          </label>
          <input
            id="title"
            type="text"
            formControlName="title"
            class="form-control"
            [class.is-invalid]="title?.invalid && title?.touched"
            placeholder="Brief description of the issue or request"
            maxlength="200"
          />
          <div class="form-help">
            Provide a clear, concise title (5-200 characters)
          </div>
          <div *ngIf="title?.invalid && title?.touched" class="invalid-feedback">
            <div *ngIf="title?.errors?.['required']">Title is required</div>
            <div *ngIf="title?.errors?.['minlength']">Title must be at least 5 characters</div>
            <div *ngIf="title?.errors?.['maxlength']">Title cannot exceed 200 characters</div>
          </div>
        </div>

        <!-- Description -->
        <div class="form-group">
          <label for="description" class="form-label">
            Description <span class="required">*</span>
          </label>
          <textarea
            id="description"
            formControlName="description"
            class="form-control"
            [class.is-invalid]="description?.invalid && description?.touched"
            placeholder="Detailed description of the issue, including steps to reproduce, expected behavior, and any error messages"
            rows="6"
          ></textarea>
          <div class="form-help">
            Provide detailed information about the issue or request (minimum 10 characters)
          </div>
          <div *ngIf="description?.invalid && description?.touched" class="invalid-feedback">
            <div *ngIf="description?.errors?.['required']">Description is required</div>
            <div *ngIf="description?.errors?.['minlength']">Description must be at least 10 characters</div>
          </div>
        </div>
      </div>

      <!-- Classification Section -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="icon-category"></i>
          Classification
        </h2>

        <div class="form-row">
          <!-- Ticket Type -->
          <div class="form-group">
            <label for="ticket_type" class="form-label">
              Type <span class="required">*</span>
            </label>
            <select
              id="ticket_type"
              formControlName="ticket_type"
              class="form-control"
              [class.is-invalid]="ticket_type?.invalid && ticket_type?.touched"
            >
              <option *ngFor="let type of typeOptions" [value]="type.value">
                {{ type.label }}
              </option>
            </select>
            <div class="form-help">
              {{ getTypeDescription(ticketForm.get('ticket_type')?.value) }}
            </div>
          </div>

          <!-- Priority -->
          <div class="form-group">
            <label for="priority" class="form-label">
              Priority <span class="required">*</span>
            </label>
            <select
              id="priority"
              formControlName="priority"
              class="form-control priority-select"
              [class.is-invalid]="priority?.invalid && priority?.touched"
            >
              <option 
                *ngFor="let priority of priorityOptions" 
                [value]="priority.value"
                [style.color]="priority.color"
              >
                {{ priority.label }}
              </option>
            </select>
            <div class="priority-indicator" [style.background-color]="getPriorityColor(ticketForm.get('priority')?.value)"></div>
          </div>
        </div>

        <!-- Category -->
        <div class="form-group">
          <label for="category" class="form-label">Category</label>
          <select
            id="category"
            formControlName="category"
            class="form-control"
          >
            <option value="">Select a category (optional)</option>
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
          <div class="form-help">
            Choose a category to help route your ticket to the right team
          </div>
        </div>
      </div>

      <!-- Assignment Section -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="icon-user"></i>
          Assignment & Timeline
        </h2>

        <div class="form-row">
          <!-- Assignee -->
          <div class="form-group">
            <label for="assignee" class="form-label">Assign to</label>
            <select
              id="assignee"
              formControlName="assignee"
              class="form-control"
            >
              <option value="">Auto-assign (recommended)</option>
              <option *ngFor="let user of users" [value]="user.id">
                {{ formatUserName(user) }}
                <span *ngIf="user.email" class="user-email"> ({{ user.email }})</span>
              </option>
            </select>
            <div class="form-help">
              Leave blank for automatic assignment based on category and workload
            </div>
          </div>

          <!-- Due Date -->
          <div class="form-group">
            <label for="due_date" class="form-label">Due Date</label>
            <input
              id="due_date"
              type="datetime-local"
              formControlName="due_date"
              class="form-control"
              [min]="minDate"
            />
            <div class="form-help">
              Optional: Set a target resolution date
            </div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="onCancel()"
          [disabled]="isSubmitting"
        >
          <i class="icon-cancel"></i>
          Cancel
        </button>
        
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="ticketForm.invalid || isSubmitting"
        >
          <span *ngIf="isSubmitting" class="spinner-small"></span>
          <i *ngIf="!isSubmitting" class="icon-save"></i>
          {{ isSubmitting ? 'Creating...' : 'Create Ticket' }}
        </button>
      </div>
    </form>
  </div>
</div>